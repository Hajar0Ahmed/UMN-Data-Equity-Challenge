---
title: "ORDINAL LOGISTIC REGRESSION FOR PUBH DATA EQUITY CHALLENGE"
author: "Hajar Ahmed"
date: "2024-10-29"
output: html_document
---

```{r include=FALSE}
dat <- read.csv(file.choose())

dat[!is.na(dat$Drinking_Level),]


##download and import packages
#install.packages("MASS")
#install.packages("brant")
#install.packages("car")
#install.packages("VGAM")

library(MASS)
library(brant)
library(car)
library(VGAM)
```

According to the CDC, the threshold for excessive drinking is different for both men and women. For a woman, 4 or more drinks constitutes excessive drinking, whereas for men that number is 5. For our response variable, we will classify respondants to the SHAPE questionnaire as non-drinker, a moderate drinker, and an excessive drinker. This gives use three levels to use in our ordinal logistic regression.

Explanatory variables we will be studying include...

citation: stats.oarc.ucla
```{r}
lapply(dat[, c("Categorized_Gender","Categorized_Sexuality")], table)
```

```{r}
#Model
dat$Drinking_Level <- factor(dat$Drinking_Level, levels = c("1", "2", "3"), ordered = TRUE)

m1 <- polr(Drinking_Level ~ Categorized_Gender + Categorized_Sexuality, data = dat, Hess = TRUE)

#summary(m)

m<- vglm(Drinking_Level ~ Categorized_Gender + Categorized_Sexuality, family=cumulative(parallel=FALSE),data=dat)



summary(m)

```
```{r}
#multicollinearity
vif(m1)
```

```{r}
##proportional odds assumption
#brant.test(m)
#brant.test(m, global=FALSE, call=FALSE)
brant::brant(m1)
#pval < .05 is a failure

```
```{r}
#odds ratios
#ex. means that for someone who is male is 1.2x that of other people
exp(coef(m))

#Interpretation of generalized ordered logistic model
#A Male is 19% less likley than a woman to to go from nondrinking to moderate drinking

```
```{r}
#Pvals and Conf int

#ctable <- coef(summary(m))

#p <- pnorm(abs(ctable[, "t value"]), lower.tail = FALSE) * 2

#ctable <- cbind(ctable, "p value" = p)

#ci <- confint(m)

confint <- confint(m,level=0.95)
exp_confint<-exp(confint)
exp_confint
```



```{r}
#Plot predicted probabilities
library(ggplot2)
library(reshape2)

newdat <- data.frame(
  Categorized_Gender = rep(c("Male","Female", "NonBinary","Other"), each=175),
  Categorized_Sexuality = rep(c("0","Bi_Pan","Gay","Other","Queer","Questioining","Straight"), each=100)
)

newdat<- cbind(newdat,predict(m, newdat, type="response"))
colnames(newdat)[3:5]<-c("No_Drinking","Moderate_Drinking","Excessive_Drinking")

lnewdat <- melt(newdat, id.vars = c("Categorized_Gender", "Categorized_Sexuality"),
  variable.name = "Drinking_Level", value.name="Probability")


ggplot(lnewdat, aes(x = Categorized_Sexuality, y =Probability, colour = Drinking_Level)) +
  geom_line() + facet_grid(Categorized_Gender ~ ., labeller=label_both) + labs(x="Sexuality", y="Predicted Probability",title="Predicted Probabilities of Drinking Levels by Gender and Sexuality", color= "Drinking Level")+ theme_minimal()



# Create a new data frame for predictions

#new_data <- data.frame(independent_variable = seq(min(your_data$independent_variable), max(your_data$independent_variable), length.out = 100))



# Generate predicted probabilities

#predictions <- predict(model, newdata = new_data, type = "response")



# Plot the results using ggplot2

#ggplot(data = new_data, aes(x = independent_variable, y = predictions, color = factor(levels(predictions)))) +

#  geom_line() + 

#  labs(title = "Predicted Probabilities by Independent Variable") 
```

Correlation Plots
https://stackoverflow.com/questions/52554336/plot-the-equivalent-of-correlation-matrix-for-factors-categorical-data-and-mi
```{r}
#install.packages("ggcorrplot")

#Create correlation matrix plot similar 
library(ggcorrplot)
model.matrix(~0+., data=df) %>% 
  cor(use="pairwise.complete.obs") %>% 
  ggcorrplot(show.diag=FALSE, type="lower", lab=TRUE, lab_size=2)
```


